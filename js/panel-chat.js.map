{"version":3,"file":"panel-chat.js","names":["ChatRoom","_PSRoom","_inheritsLoose","options","_this","call","classType","users","userCount","canConnect","pmTarget","challengeMenuOpen","challengingFormat","challengedFormat","updateTarget","connect","_proto","prototype","connected","PS","send","id","connectWhenLoggedIn","force","startsWith","_this$id$slice$split","slice","split","id1","id2","user","userid","toID","setUsers","title","handleMessage","line","spaceIndex","indexOf","cmd","target","roomid","test","join","leave","openChallenge","cancelChallenge","update","receiveLine","direct","count","usernames","_i2","length","username","addUser","removeUser","noUpdate","renameUser","oldUsername","destroy","PSRoom","ChatTextEntry","_preact$Component","_this2","_len","arguments","args","Array","_key","apply","concat","subscription","textbox","history","historyIndex","style","height","newHeight","Math","min","max","scrollHeight","focusIfNoSelection","e","tagName","selection","window","getSelection","type","elem","base","children","focus","keyDown","handleKey","props","onKey","preventDefault","stopImmediatePropagation","_proto2","componentDidMount","_this3","subscribe","forceUpdate","componentWillUnmount","unsubscribe","submit","onMessage","value","historyPush","historyUp","historyDown","duplicateIndex","lastIndexOf","splice","push","cmdKey","metaKey","ctrlKey","altKey","shiftKey","keyCode","toggleFormatChar","formatChar","setSelectionRange","start","selectionStart","end","selectionEnd","charAt","wrap","substr","nesting","render","preact","h","onClick","left","color","BattleLog","usernameColor","name","room","autofocus","rows","onInput","onKeyDown","resize","width","padding","placeholder","focusPreview","Component","ChatPanel","_PSRoomPanel","_this4","_len2","_key2","text","chatLog","getElementsByClassName","scrollTop","offsetHeight","makeChallenge","format","team","packedTeam","Error","acceptChallenge","_proto3","querySelector","tinyLayout","challengeTo","TeamForm","onSubmit","challengeFrom","PSPanelWrapper","ChatLog","ChatUserList","minimized","PSRoomPanel","_preact$Component2","_this5","_len3","_key3","state","expanded","toggleExpanded","setState","_proto4","_this6","msg","userList","Object","entries","PSUtils","sortBy","_ref","server","getGroup","order","endsWith","map","_ref2","groupSymbol","group","groups","key","includes","_preact$Component3","_this7","_len4","_key4","log","_proto5","_this8","noSubscription","tokens","parseInt","shift","add","setControlsJSX","shouldComponentUpdate","className","top","updateScroll","jsx","controlsElem","undefined","document","createElement","appendChild","battle","scene","role","roomTypes","Model","updateRoomTypes"],"sources":["../src/panel-chat.tsx"],"sourcesContent":["/**\n * Chat panel\n *\n * @author Guangcong Luo <guangcongluo@gmail.com>\n * @license AGPLv3\n */\n\nclass ChatRoom extends PSRoom {\n\treadonly classType: 'chat' | 'battle' = 'chat';\n\tusers: {[userid: string]: string} = {};\n\tuserCount = 0;\n\treadonly canConnect = true;\n\n\t// PM-only properties\n\tpmTarget: string | null = null;\n\tchallengeMenuOpen = false;\n\tchallengingFormat: string | null = null;\n\tchallengedFormat: string | null = null;\n\n\tconstructor(options: RoomOptions) {\n\t\tsuper(options);\n\t\tif (options.pmTarget) this.pmTarget = options.pmTarget as string;\n\t\tif (options.challengeMenuOpen) this.challengeMenuOpen = true;\n\t\tthis.updateTarget(true);\n\t\tthis.connect();\n\t}\n\tconnect() {\n\t\tif (!this.connected) {\n\t\t\tif (!this.pmTarget) PS.send(`|/join ${this.id}`);\n\t\t\tthis.connected = true;\n\t\t\tthis.connectWhenLoggedIn = false;\n\t\t}\n\t}\n\tupdateTarget(force?: boolean) {\n\t\tif (this.id.startsWith('pm-')) {\n\t\t\tconst [id1, id2] = this.id.slice(3).split('-');\n\t\t\tif (id1 === PS.user.userid && toID(this.pmTarget) !== id2) {\n\t\t\t\tthis.pmTarget = id2;\n\t\t\t} else if (id2 === PS.user.userid && toID(this.pmTarget) !== id1) {\n\t\t\t\tthis.pmTarget = id1;\n\t\t\t} else if (!force) {\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tthis.pmTarget = id1;\n\t\t\t}\n\t\t\tif (!this.userCount) {\n\t\t\t\tthis.setUsers(2, [` ${id1}`, ` ${id2}`]);\n\t\t\t}\n\t\t\tthis.title = `[PM] ${this.pmTarget}`;\n\t\t}\n\t}\n\t/**\n\t * @return true to prevent line from being sent to server\n\t */\n\thandleMessage(line: string) {\n\t\tif (!line.startsWith('/') || line.startsWith('//')) return false;\n\t\tconst spaceIndex = line.indexOf(' ');\n\t\tconst cmd = spaceIndex >= 0 ? line.slice(1, spaceIndex) : line.slice(1);\n\t\tconst target = spaceIndex >= 0 ? line.slice(spaceIndex + 1) : '';\n\t\tswitch (cmd) {\n\t\tcase 'j': case 'join': {\n\t\t\tconst roomid = /[^a-z0-9-]/.test(target) ? toID(target) as any as RoomID : target as RoomID;\n\t\t\tPS.join(roomid);\n\t\t\treturn true;\n\t\t} case 'part': case 'leave': {\n\t\t\tconst roomid = /[^a-z0-9-]/.test(target) ? toID(target) as any as RoomID : target as RoomID;\n\t\t\tPS.leave(roomid || this.id);\n\t\t\treturn true;\n\t\t} case 'chall': case 'challenge': {\n\t\t\tif (target) {\n\t\t\t\tPS.join(`challenge-${toID(target)}` as RoomID);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tthis.openChallenge();\n\t\t\treturn true;\n\t\t} case 'cchall': case 'cancelchallenge': {\n\t\t\tthis.cancelChallenge();\n\t\t\treturn true;\n\t\t} case 'reject': {\n\t\t\tthis.challengedFormat = null;\n\t\t\tthis.update(null);\n\t\t\treturn false;\n\t\t}}\n\t\treturn super.handleMessage(line);\n\t}\n\topenChallenge() {\n\t\tif (!this.pmTarget) {\n\t\t\tthis.receiveLine([`error`, `Can only be used in a PM.`]);\n\t\t\treturn;\n\t\t}\n\t\tthis.challengeMenuOpen = true;\n\t\tthis.update(null);\n\t}\n\tcancelChallenge() {\n\t\tif (!this.pmTarget) {\n\t\t\tthis.receiveLine([`error`, `Can only be used in a PM.`]);\n\t\t\treturn;\n\t\t}\n\t\tif (this.challengingFormat) {\n\t\t\tthis.send('/cancelchallenge', true);\n\t\t\tthis.challengingFormat = null;\n\t\t\tthis.challengeMenuOpen = true;\n\t\t} else {\n\t\t\tthis.challengeMenuOpen = false;\n\t\t}\n\t\tthis.update(null);\n\t}\n\tsend(line: string, direct?: boolean) {\n\t\tthis.updateTarget();\n\t\tif (!direct && !line) return;\n\t\tif (!direct && this.handleMessage(line)) return;\n\t\tif (this.pmTarget) {\n\t\t\tPS.send(`|/pm ${this.pmTarget}, ${line}`);\n\t\t\treturn;\n\t\t}\n\t\tsuper.send(line, true);\n\t}\n\tsetUsers(count: number, usernames: string[]) {\n\t\tthis.userCount = count;\n\t\tthis.users = {};\n\t\tfor (const username of usernames) {\n\t\t\tconst userid = toID(username);\n\t\t\tthis.users[userid] = username;\n\t\t}\n\t\tthis.update(null);\n\t}\n\taddUser(username: string) {\n\t\tconst userid = toID(username);\n\t\tif (!(userid in this.users)) this.userCount++;\n\t\tthis.users[userid] = username;\n\t\tthis.update(null);\n\t}\n\tremoveUser(username: string, noUpdate?: boolean) {\n\t\tconst userid = toID(username);\n\t\tif (userid in this.users) {\n\t\t\tthis.userCount--;\n\t\t\tdelete this.users[userid];\n\t\t}\n\t\tif (!noUpdate) this.update(null);\n\t}\n\trenameUser(username: string, oldUsername: string) {\n\t\tthis.removeUser(oldUsername, true);\n\t\tthis.addUser(username);\n\t\tthis.update(null);\n\t}\n\tdestroy() {\n\t\tif (this.pmTarget) this.connected = false;\n\t\tsuper.destroy();\n\t}\n}\n\nclass ChatTextEntry extends preact.Component<{\n\troom: PSRoom, onMessage: (msg: string) => void, onKey: (e: KeyboardEvent) => boolean,\n\tleft?: number,\n}> {\n\tsubscription: PSSubscription | null = null;\n\ttextbox: HTMLTextAreaElement = null!;\n\thistory: string[] = [];\n\thistoryIndex = 0;\n\tcomponentDidMount() {\n\t\tthis.subscription = PS.user.subscribe(() => {\n\t\t\tthis.forceUpdate();\n\t\t});\n\t\tthis.textbox = this.base!.children[0].children[1] as HTMLTextAreaElement;\n\t\tif (this.base) this.update();\n\t}\n\tcomponentWillUnmount() {\n\t\tif (this.subscription) {\n\t\t\tthis.subscription.unsubscribe();\n\t\t\tthis.subscription = null;\n\t\t}\n\t}\n\tupdate = () => {\n\t\tconst textbox = this.textbox;\n\t\ttextbox.style.height = `12px`;\n\t\tconst newHeight = Math.min(Math.max(textbox.scrollHeight - 2, 16), 600);\n\t\ttextbox.style.height = `${newHeight}px`;\n\t};\n\tfocusIfNoSelection = (e: Event) => {\n\t\tif ((e.target as HTMLElement).tagName === 'TEXTAREA') return;\n\t\tconst selection = window.getSelection()!;\n\t\tif (selection.type === 'Range') return;\n\t\tconst elem = this.base!.children[0].children[1] as HTMLTextAreaElement;\n\t\telem.focus();\n\t};\n\tsubmit() {\n\t\tthis.props.onMessage(this.textbox.value);\n\t\tthis.historyPush(this.textbox.value);\n\t\tthis.textbox.value = '';\n\t\tthis.update();\n\t\treturn true;\n\t}\n\tkeyDown = (e: KeyboardEvent) => {\n\t\tif (this.handleKey(e) || this.props.onKey(e)) {\n\t\t\te.preventDefault();\n\t\t\te.stopImmediatePropagation();\n\t\t}\n\t};\n\thistoryUp() {\n\t\tif (this.historyIndex === 0) return false;\n\t\tconst line = this.textbox.value;\n\t\tif (line !== '') this.history[this.historyIndex] = line;\n\t\tthis.textbox.value = this.history[--this.historyIndex];\n\t\treturn true;\n\t}\n\thistoryDown() {\n\t\tconst line = this.textbox.value;\n\t\tif (line !== '') this.history[this.historyIndex] = line;\n\t\tif (this.historyIndex === this.history.length) {\n\t\t\tif (!line) return false;\n\t\t\tthis.textbox.value = '';\n\t\t} else if (++this.historyIndex === this.history.length) {\n\t\t\tthis.textbox.value = '';\n\t\t} else {\n\t\t\tthis.textbox.value = this.history[this.historyIndex];\n\t\t}\n\t\treturn true;\n\t}\n\thistoryPush(line: string) {\n\t\tconst duplicateIndex = this.history.lastIndexOf(line);\n\t\tif (duplicateIndex >= 0) this.history.splice(duplicateIndex, 1);\n\t\tif (this.history.length > 100) this.history.splice(0, 20);\n\t\tthis.history.push(line);\n\t\tthis.historyIndex = this.history.length;\n\t}\n\thandleKey(e: KeyboardEvent) {\n\t\tconst cmdKey = ((e.metaKey ? 1 : 0) + (e.ctrlKey ? 1 : 0) === 1) && !e.altKey && !e.shiftKey;\n\t\tif (e.keyCode === 13 && !e.shiftKey) { // Enter key\n\t\t\treturn this.submit();\n\t\t} else if (e.keyCode === 73 && cmdKey) { // Ctrl + I key\n\t\t\treturn this.toggleFormatChar('_');\n\t\t} else if (e.keyCode === 66 && cmdKey) { // Ctrl + B key\n\t\t\treturn this.toggleFormatChar('*');\n\t\t} else if (e.keyCode === 192 && cmdKey) { // Ctrl + ` key\n\t\t\treturn this.toggleFormatChar('`');\n\t\t// } else if (e.keyCode === 9 && !e.ctrlKey) { // Tab key\n\t\t// \tconst reverse = !!e.shiftKey; // Shift+Tab reverses direction\n\t\t// \treturn this.handleTabComplete(this.$chatbox, reverse);\n\t\t} else if (e.keyCode === 38 && !e.shiftKey && !e.altKey) { // Up key\n\t\t\treturn this.historyUp();\n\t\t} else if (e.keyCode === 40 && !e.shiftKey && !e.altKey) { // Down key\n\t\t\treturn this.historyDown();\n\t\t// } else if (app.user.lastPM && (textbox.value === '/reply' || textbox.value === '/r' || textbox.value === '/R') && e.keyCode === 32) { // '/reply ' is being written\n\t\t// \tvar val = '/pm ' + app.user.lastPM + ', ';\n\t\t// \ttextbox.value = val;\n\t\t// \ttextbox.setSelectionRange(val.length, val.length);\n\t\t// \treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\ttoggleFormatChar(formatChar: string) {\n\t\tconst textbox = this.textbox;\n\t\tif (!textbox.setSelectionRange) return false;\n\n\t\tlet value = textbox.value;\n\t\tlet start = textbox.selectionStart;\n\t\tlet end = textbox.selectionEnd;\n\n\t\t// make sure start and end aren't midway through the syntax\n\t\tif (value.charAt(start) === formatChar && value.charAt(start - 1) === formatChar &&\n\t\t\tvalue.charAt(start - 2) !== formatChar) {\n\t\t\tstart++;\n\t\t}\n\t\tif (value.charAt(end) === formatChar && value.charAt(end - 1) === formatChar &&\n\t\t\tvalue.charAt(end - 2) !== formatChar) {\n\t\t\tend--;\n\t\t}\n\n\t\t// wrap in doubled format char\n\t\tconst wrap = formatChar + formatChar;\n\t\tvalue = value.substr(0, start) + wrap + value.substr(start, end - start) + wrap + value.substr(end);\n\t\tstart += 2;\n\t\tend += 2;\n\n\t\t// prevent nesting\n\t\tconst nesting = wrap + wrap;\n\t\tif (value.substr(start - 4, 4) === nesting) {\n\t\t\tvalue = value.substr(0, start - 4) + value.substr(start);\n\t\t\tstart -= 4;\n\t\t\tend -= 4;\n\t\t} else if (start !== end && value.substr(start - 2, 4) === nesting) {\n\t\t\tvalue = value.substr(0, start - 2) + value.substr(start + 2);\n\t\t\tstart -= 2;\n\t\t\tend -= 4;\n\t\t}\n\t\tif (value.substr(end, 4) === nesting) {\n\t\t\tvalue = value.substr(0, end) + value.substr(end + 4);\n\t\t} else if (start !== end && value.substr(end - 2, 4) === nesting) {\n\t\t\tvalue = value.substr(0, end - 2) + value.substr(end + 2);\n\t\t\tend -= 2;\n\t\t}\n\n\t\ttextbox.value = value;\n\t\ttextbox.setSelectionRange(start, end);\n\t\treturn true;\n\t}\n\trender() {\n\t\treturn <div\n\t\t\tclass=\"chat-log-add hasuserlist\" onClick={this.focusIfNoSelection} style={{left: this.props.left || 0}}\n\t\t>\n\t\t\t<form class=\"chatbox\">\n\t\t\t\t<label style={{color: BattleLog.usernameColor(PS.user.userid)}}>{PS.user.name}:</label>\n\t\t\t\t<textarea\n\t\t\t\t\tclass={this.props.room.connected ? 'textbox' : 'textbox disabled'}\n\t\t\t\t\tautofocus\n\t\t\t\t\trows={1}\n\t\t\t\t\tonInput={this.update}\n\t\t\t\t\tonKeyDown={this.keyDown}\n\t\t\t\t\tstyle={{resize: 'none', width: '100%', height: '16px', padding: '2px 3px 1px 3px'}}\n\t\t\t\t\tplaceholder={PS.focusPreview(this.props.room)}\n\t\t\t\t/>\n\t\t\t</form>\n\t\t</div>;\n\t}\n}\n\nclass ChatPanel extends PSRoomPanel<ChatRoom> {\n\tsend = (text: string) => {\n\t\tthis.props.room.send(text);\n\t};\n\tfocus() {\n\t\tthis.base!.querySelector('textarea')!.focus();\n\t}\n\tfocusIfNoSelection = () => {\n\t\tconst selection = window.getSelection()!;\n\t\tif (selection.type === 'Range') return;\n\t\tthis.focus();\n\t};\n\tonKey = (e: KeyboardEvent) => {\n\t\tif (e.keyCode === 33) { // Pg Up key\n\t\t\tconst chatLog = this.base!.getElementsByClassName('chat-log')[0] as HTMLDivElement;\n\t\t\tchatLog.scrollTop = chatLog.scrollTop - chatLog.offsetHeight + 60;\n\t\t\treturn true;\n\t\t} else if (e.keyCode === 34) { // Pg Dn key\n\t\t\tconst chatLog = this.base!.getElementsByClassName('chat-log')[0] as HTMLDivElement;\n\t\t\tchatLog.scrollTop = chatLog.scrollTop + chatLog.offsetHeight - 60;\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t};\n\tmakeChallenge = (e: Event, format: string, team?: Team) => {\n\t\tconst room = this.props.room;\n\t\tconst packedTeam = team ? team.packedTeam : '';\n\t\tif (!room.pmTarget) throw new Error(\"Not a PM room\");\n\t\tPS.send(`|/utm ${packedTeam}`);\n\t\tPS.send(`|/challenge ${room.pmTarget}, ${format}`);\n\t\troom.challengeMenuOpen = false;\n\t\troom.challengingFormat = format;\n\t\troom.update(null);\n\t};\n\tacceptChallenge = (e: Event, format: string, team?: Team) => {\n\t\tconst room = this.props.room;\n\t\tconst packedTeam = team ? team.packedTeam : '';\n\t\tif (!room.pmTarget) throw new Error(\"Not a PM room\");\n\t\tPS.send(`|/utm ${packedTeam}`);\n\t\tthis.props.room.send(`/accept`);\n\t\troom.challengedFormat = null;\n\t\troom.update(null);\n\t};\n\trender() {\n\t\tconst room = this.props.room;\n\t\tconst tinyLayout = room.width < 450;\n\n\t\tconst challengeTo = room.challengingFormat ? <div class=\"challenge\">\n\t\t\t<TeamForm format={room.challengingFormat} onSubmit={null}>\n\t\t\t\t<button name=\"cmd\" value=\"/cancelchallenge\" class=\"button\">Cancel</button>\n\t\t\t</TeamForm>\n\t\t</div> : room.challengeMenuOpen ? <div class=\"challenge\">\n\t\t\t<TeamForm onSubmit={this.makeChallenge}>\n\t\t\t\t<button type=\"submit\" class=\"button\"><strong>Challenge</strong></button> {}\n\t\t\t\t<button name=\"cmd\" value=\"/cancelchallenge\" class=\"button\">Cancel</button>\n\t\t\t</TeamForm>\n\t\t</div> : null;\n\n\t\tconst challengeFrom = room.challengedFormat ? <div class=\"challenge\">\n\t\t\t<TeamForm format={room.challengedFormat} onSubmit={this.acceptChallenge}>\n\t\t\t\t<button type=\"submit\" class=\"button\"><strong>Accept</strong></button> {}\n\t\t\t\t<button name=\"cmd\" value=\"/reject\" class=\"button\">Reject</button>\n\t\t\t</TeamForm>\n\t\t</div> : null;\n\n\t\treturn <PSPanelWrapper room={room}>\n\t\t\t<div class=\"tournament-wrapper hasuserlist\"></div>\n\t\t\t<ChatLog class=\"chat-log\" room={this.props.room} onClick={this.focusIfNoSelection} left={tinyLayout ? 0 : 146}>\n\t\t\t\t{challengeTo || challengeFrom && [challengeTo, challengeFrom]}\n\t\t\t</ChatLog>\n\t\t\t<ChatTextEntry room={this.props.room} onMessage={this.send} onKey={this.onKey} left={tinyLayout ? 0 : 146} />\n\t\t\t<ChatUserList room={this.props.room} minimized={tinyLayout} />\n\t\t</PSPanelWrapper>;\n\t}\n}\n\nclass ChatUserList extends preact.Component<{room: ChatRoom, left?: number, minimized?: boolean}> {\n\tsubscription: PSSubscription | null = null;\n\tstate = {\n\t\texpanded: false,\n\t};\n\ttoggleExpanded = () => {\n\t\tthis.setState({expanded: !this.state.expanded});\n\t};\n\tcomponentDidMount() {\n\t\tthis.subscription = this.props.room.subscribe(msg => {\n\t\t\tif (!msg) this.forceUpdate();\n\t\t});\n\t}\n\tcomponentWillUnmount() {\n\t\tif (this.subscription) this.subscription.unsubscribe();\n\t}\n\trender() {\n\t\tconst room = this.props.room;\n\t\tlet userList = Object.entries(room.users) as [ID, string][];\n\t\tPSUtils.sortBy(userList, ([id, name]) => (\n\t\t\t[PS.server.getGroup(name.charAt(0)).order, !name.endsWith('@!'), id]\n\t\t));\n\t\treturn <ul class={'userlist' + (this.props.minimized ? (this.state.expanded ? ' userlist-maximized' : ' userlist-minimized') : '')} style={{left: this.props.left || 0}}>\n\t\t\t<li class=\"userlist-count\" onClick={this.toggleExpanded}><small>{room.userCount} users</small></li>\n\t\t\t{userList.map(([userid, name]) => {\n\t\t\t\tconst groupSymbol = name.charAt(0);\n\t\t\t\tconst group = PS.server.groups[groupSymbol] || {type: 'user', order: 0};\n\t\t\t\tlet color;\n\t\t\t\tif (name.endsWith('@!')) {\n\t\t\t\t\tname = name.slice(0, -2);\n\t\t\t\t\tcolor = '#888888';\n\t\t\t\t} else {\n\t\t\t\t\tcolor = BattleLog.usernameColor(userid);\n\t\t\t\t}\n\t\t\t\treturn <li key={userid}><button class=\"userbutton username\" data-name={name}>\n\t\t\t\t\t<em class={`group${['leadership', 'staff'].includes(group.type!) ? ' staffgroup' : ''}`}>\n\t\t\t\t\t\t{groupSymbol}\n\t\t\t\t\t</em>\n\t\t\t\t\t{group.type === 'leadership' ?\n\t\t\t\t\t\t<strong><em style={{color}}>{name.substr(1)}</em></strong>\n\t\t\t\t\t: group.type === 'staff' ?\n\t\t\t\t\t\t<strong style={{color}}>{name.substr(1)}</strong>\n\t\t\t\t\t:\n\t\t\t\t\t\t<span style={{color}}>{name.substr(1)}</span>\n\t\t\t\t\t}\n\t\t\t\t</button></li>;\n\t\t\t})}\n\t\t</ul>;\n\t}\n}\n\nclass ChatLog extends preact.Component<{\n\tclass: string, room: ChatRoom, onClick?: (e: Event) => void, children?: preact.ComponentChildren,\n\tleft?: number, top?: number, noSubscription?: boolean;\n}> {\n\tlog: BattleLog | null = null;\n\tsubscription: PSSubscription | null = null;\n\tcomponentDidMount() {\n\t\tif (!this.props.noSubscription) {\n\t\t\tthis.log = new BattleLog(this.base! as HTMLDivElement);\n\t\t}\n\t\tthis.subscription = this.props.room.subscribe(tokens => {\n\t\t\tif (!tokens) return;\n\t\t\tswitch (tokens[0]) {\n\t\t\tcase 'users':\n\t\t\t\tconst usernames = tokens[1].split(',');\n\t\t\t\tconst count = parseInt(usernames.shift()!, 10);\n\t\t\t\tthis.props.room.setUsers(count, usernames);\n\t\t\t\treturn;\n\t\t\tcase 'join': case 'j': case 'J':\n\t\t\t\tthis.props.room.addUser(tokens[1]);\n\t\t\t\tbreak;\n\t\t\tcase 'leave': case 'l': case 'L':\n\t\t\t\tthis.props.room.removeUser(tokens[1]);\n\t\t\t\tbreak;\n\t\t\tcase 'name': case 'n': case 'N':\n\t\t\t\tthis.props.room.renameUser(tokens[1], tokens[2]);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (!this.props.noSubscription) this.log!.add(tokens);\n\t\t});\n\t\tthis.setControlsJSX(this.props.children);\n\t}\n\tcomponentWillUnmount() {\n\t\tif (this.subscription) this.subscription.unsubscribe();\n\t}\n\tshouldComponentUpdate(props: typeof ChatLog.prototype.props) {\n\t\tif (props.class !== this.props.class) {\n\t\t\tthis.base!.className = props.class;\n\t\t}\n\t\tif (props.left !== this.props.left) this.base!.style.left = `${props.left || 0}px`;\n\t\tif (props.top !== this.props.top) this.base!.style.top = `${props.top || 0}px`;\n\t\tthis.setControlsJSX(props.children);\n\t\tthis.updateScroll();\n\t\treturn false;\n\t}\n\tsetControlsJSX(jsx: preact.ComponentChildren | undefined) {\n\t\tconst children = this.base!.children;\n\t\tlet controlsElem = children[children.length - 1] as HTMLDivElement | undefined;\n\t\tif (controlsElem && controlsElem.className !== 'controls') controlsElem = undefined;\n\t\tif (!jsx) {\n\t\t\tif (!controlsElem) return;\n\t\t\tpreact.render(null, this.base!, controlsElem);\n\t\t\tthis.updateScroll();\n\t\t\treturn;\n\t\t}\n\t\tif (!controlsElem) {\n\t\t\tcontrolsElem = document.createElement('div');\n\t\t\tcontrolsElem.className = 'controls';\n\t\t\tthis.base!.appendChild(controlsElem);\n\t\t}\n\t\tpreact.render(<div class=\"controls\">{jsx}</div>, this.base!, controlsElem);\n\t\tthis.updateScroll();\n\t}\n\tupdateScroll() {\n\t\tif (this.log) {\n\t\t\tthis.log.updateScroll();\n\t\t} else if (this.props.room.battle) {\n\t\t\tthis.log = (this.props.room.battle as Battle).scene.log;\n\t\t\tthis.log.updateScroll();\n\t\t}\n\t}\n\trender() {\n\t\treturn <div class={this.props.class} role=\"log\" onClick={this.props.onClick} style={{\n\t\t\tleft: this.props.left || 0, top: this.props.top || 0,\n\t\t}}></div>;\n\t}\n}\n\nPS.roomTypes['chat'] = {\n\tModel: ChatRoom,\n\tComponent: ChatPanel,\n};\nPS.updateRoomTypes();\n"],"mappings":"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"}