{"version":3,"file":"client-core.js","names":["Array","prototype","indexOf","searchElement","fromIndex","i","length","includes","thing","String","startsWith","slice","endsWith","trim","replace","Object","assign","rest","arguments","source","k","create","proto","F","window","console","log","PSURL","document","location","protocol","Config","routes","client","PSSubscription","observable","listener","_proto","unsubscribe","index","subscriptions","splice","PSModel","_proto2","subscribe","subscription","push","subscribeAndRun","update","_i2","_this$subscriptions2","PSStreamModel","updates","_proto3","_i4","_this$updates2","value","_i6","_this$subscriptions4","PSBackground","_PSStreamModel","_inheritsLoose","_class2","_this","call","id","curId","attrib","changeCount","menuColors","bg","localStorage","getItem","split","set","_unused","_proto4","save","bgUrl","setItem","join","bgid","undefined","host","bgs","Math","floor","random","url","title","artist","charAt","r","parseInt","g","b","hs","getHueSat","extractMenuColors","_this2","img","Image","onload","colorThief","ColorThief","colors","getPalette","color","unshift","_unused2","src","max","min","l","d","s","h","body","style","background","backgroundSize","buttonStyleElem","getElementById","textContent","cssBuf","n","_i8","_PSBackground$menuCol2","HTMLStyleElement","head","appendChild"],"sources":["../src/client-core.ts"],"sourcesContent":["/**\n * Client core\n *\n * No dependencies.\n * Does three unrelated things:\n * 1. sets up polyfills where necessary\n * 2. sets up PS's model base classes\n * 3. sets up the model and view for PS's backgrounds\n *\n * The background is mostly here so the new background can be loaded ASAP.\n *\n * @author Guangcong Luo <guancongluo@gmail.com>\n * @license AGPLv3\n */\n\n/**********************************************************************\n * Polyfills\n *********************************************************************/\n\nif (!Array.prototype.indexOf) {\n\tArray.prototype.indexOf = function (searchElement, fromIndex) {\n\t\tfor (let i = (fromIndex || 0); i < this.length; i++) {\n\t\t\tif (this[i] === searchElement) return i;\n\t\t}\n\t\treturn -1;\n\t};\n}\nif (!Array.prototype.includes) {\n\tArray.prototype.includes = function (thing) {\n\t\treturn this.indexOf(thing) !== -1;\n\t};\n}\nif (!String.prototype.includes) {\n\tString.prototype.includes = function (thing) {\n\t\treturn this.indexOf(thing) !== -1;\n\t};\n}\nif (!String.prototype.startsWith) {\n\tString.prototype.startsWith = function (thing) {\n\t\treturn this.slice(0, thing.length) === thing;\n\t};\n}\nif (!String.prototype.endsWith) {\n\tString.prototype.endsWith = function (thing) {\n\t\treturn this.slice(-thing.length) === thing;\n\t};\n}\nif (!String.prototype.trim) {\n\tString.prototype.trim = function () {\n\t\treturn this.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '');\n\t};\n}\nif (!Object.assign) {\n\tObject.assign = function (thing: any, rest: any) {\n\t\tfor (let i = 1; i < arguments.length; i++) {\n\t\t\tlet source = arguments[i];\n\t\t\tfor (let k in source) {\n\t\t\t\tthing[k] = source[k];\n\t\t\t}\n\t\t}\n\t\treturn thing;\n\t};\n}\nif (!Object.create) {\n\tObject.create = function (proto: any) {\n\t\tfunction F() {}\n\t\tF.prototype = proto;\n\t\treturn new (F as any)();\n\t};\n}\nif (!window.console) {\n\t// in IE8, the console object is only defined when devtools is open\n\t// I don't actually know if this will cause problems when you open devtools,\n\t// but that's something I can figure out if I ever bother testing in IE8\n\t(window as any).console = {\n\t\tlog() {},\n\t};\n}\n\n/**********************************************************************\n * PS Models\n *********************************************************************/\n// PS's model classes are defined here\n\nconst PSURL = `${document.location!.protocol !== 'http:' ? 'https:' : ''}//${Config.routes.client}/`;\n\nclass PSSubscription {\n\tobservable: PSModel | PSStreamModel<any>;\n\tlistener: (value?: any) => void;\n\tconstructor(observable: PSModel | PSStreamModel<any>, listener: (value?: any) => void) {\n\t\tthis.observable = observable;\n\t\tthis.listener = listener;\n\t}\n\tunsubscribe() {\n\t\tconst index = this.observable.subscriptions.indexOf(this);\n\t\tif (index >= 0) this.observable.subscriptions.splice(index, 1);\n\t}\n}\n\n/**\n * PS Models roughly implement the Observable spec. Not the entire\n * spec - just the parts we use. PSModel just notifies subscribers of\n * updates - a simple model for React.\n */\nclass PSModel {\n\tsubscriptions = [] as PSSubscription[];\n\tsubscribe(listener: () => void) {\n\t\tconst subscription = new PSSubscription(this, listener);\n\t\tthis.subscriptions.push(subscription);\n\t\treturn subscription;\n\t}\n\tsubscribeAndRun(listener: () => void) {\n\t\tconst subscription = this.subscribe(listener);\n\t\tsubscription.listener();\n\t\treturn subscription;\n\t}\n\tupdate() {\n\t\tfor (const subscription of this.subscriptions) {\n\t\t\tsubscription.listener();\n\t\t}\n\t}\n}\n\n/**\n * PS Models roughly implement the Observable spec. PSStreamModel\n * streams some data out. This is very not-React, which generally\n * expects the DOM to be a pure function of state. Instead PSModels\n * which hold state, PSStreamModels give state directly to views,\n * so that the model doesn't need to hold a redundant copy of state.\n */\nclass PSStreamModel<T = string> {\n\tsubscriptions = [] as PSSubscription[];\n\tupdates = [] as T[];\n\tsubscribe(listener: (value: T) => void) {\n\t\t// TypeScript bug\n\t\tconst subscription: PSSubscription = new PSSubscription(this, listener);\n\t\tthis.subscriptions.push(subscription);\n\t\tif (this.updates.length) {\n\t\t\tfor (const update of this.updates) {\n\t\t\t\tsubscription.listener(update);\n\t\t\t}\n\t\t\tthis.updates = [];\n\t\t}\n\t\treturn subscription;\n\t}\n\tsubscribeAndRun(listener: (value: T) => void) {\n\t\tconst subscription = this.subscribe(listener);\n\t\tsubscription.listener(null);\n\t\treturn subscription;\n\t}\n\tupdate(value: T) {\n\t\tif (!this.subscriptions.length) {\n\t\t\t// save updates for later\n\t\t\tthis.updates.push(value);\n\t\t}\n\t\tfor (const subscription of this.subscriptions) {\n\t\t\tsubscription.listener(value);\n\t\t}\n\t}\n}\n\n// type JSONObject = {[k: string]: JSONValue};\n// type JSONArray = JSONValue[];\n// type JSONValue = number | string | boolean | null | JSONObject | JSONArray;\n\n/**********************************************************************\n * Background Model\n *********************************************************************/\n\ndeclare const ColorThief: any;\n\n/**\n * PS background model. Separate from PSPrefs because unlike prefs,\n * backgrounds can be set separately per server, instead of being\n * shared among all servers.\n *\n * Streams the current URL\n */\nconst PSBackground = new class extends PSStreamModel {\n\tid = '';\n\tcurId = '';\n\tattrib: {url: string, title: string, artist: string} | null = null;\n\tchangeCount = 0;\n\tmenuColors: string[] | null = null;\n\n\tconstructor() {\n\t\tsuper();\n\t\ttry {\n\t\t\tlet bg = localStorage.getItem('showdown_bg')!.split('\\n');\n\t\t\tif (bg.length === 1) {\n\t\t\t\tthis.set('', bg[0]);\n\t\t\t} else if (bg.length === 2) {\n\t\t\t\tthis.set(bg[0], bg[1]);\n\t\t\t} else if (bg.length >= 7) {\n\t\t\t\tthis.set(bg[0], bg[1], bg.slice(2));\n\t\t\t}\n\t\t} catch {}\n\t}\n\tsave(bgUrl: string) {\n\t\tif (this.id !== 'custom') {\n\t\t\tlocalStorage.setItem('showdown_bg', this.id);\n\t\t} else if (this.menuColors) {\n\t\t\tlocalStorage.setItem('showdown_bg', bgUrl + '\\n' + this.id + '\\n' + this.menuColors.join('\\n'));\n\t\t}\n\t}\n\n\tset(bgUrl: string, bgid: string, menuColors: string[] | null = null) {\n\t\t// id\n\t\tthis.id = bgid;\n\n\t\t// curid\n\t\tif (!bgid) {\n\t\t\tif (location.host === 'smogtours.psim.us') {\n\t\t\t\tbgid = 'shaymin';\n\t\t\t} else if (location.host === Config.routes.client) {\n\t\t\t\tconst bgs = ['horizon', 'ocean', 'waterfall', 'shaymin', 'charizards'];\n\t\t\t\tbgid = bgs[Math.floor(Math.random() * 5)];\n\t\t\t\tif (bgid === this.curId) bgid = bgs[Math.floor(Math.random() * 5)];\n\t\t\t}\n\t\t}\n\t\tthis.curId = bgid;\n\n\t\tif (!bgUrl) {\n\t\t\tbgUrl = (bgid === 'solidblue' ? '#344b6c' : PSURL + 'fx/client-bg-' + bgid + '.jpg');\n\t\t}\n\n\t\t// April Fool's 2016 - Digimon theme\n\t\t// bgid = 'digimon';\n\t\t// bgUrl = PSURL + 'sprites/afd/digimonbg.jpg';\n\n\t\tthis.changeCount++;\n\n\t\t// menuColors, attrib\n\t\tlet attrib = null;\n\t\tswitch (bgid) {\n\t\tcase 'horizon':\n\t\t\tmenuColors = [\n\t\t\t\t\"318.87640449438203,35.177865612648226%\",\n\t\t\t\t\"216,46.2962962962963%\",\n\t\t\t\t\"221.25,32.25806451612904%\",\n\t\t\t\t\"197.8021978021978,52.60115606936417%\",\n\t\t\t\t\"232.00000000000003,19.480519480519483%\",\n\t\t\t\t\"228.38709677419354,60.7843137254902%\",\n\t\t\t];\n\t\t\tattrib = {\n\t\t\t\turl: 'https://vtas.deviantart.com/art/Pokemon-Horizon-312267168',\n\t\t\t\ttitle: 'Horizon',\n\t\t\t\tartist: 'Vivian Zou',\n\t\t\t};\n\t\t\tbreak;\n\t\tcase 'ocean':\n\t\t\tmenuColors = [\n\t\t\t\t\"82.8169014084507,34.63414634146342%\",\n\t\t\t\t\"216.16438356164383,29.55465587044534%\",\n\t\t\t\t\"212.92682926829266,59.42028985507245%\",\n\t\t\t\t\"209.18918918918916,57.51295336787566%\",\n\t\t\t\t\"199.2857142857143,48.275862068965495%\",\n\t\t\t\t\"213.11999999999998,55.06607929515419%\",\n\t\t\t];\n\t\t\tattrib = {\n\t\t\t\turl: 'https://quanyails.deviantart.com/art/Sunrise-Ocean-402667154',\n\t\t\t\ttitle: 'Sunrise Ocean',\n\t\t\t\tartist: 'Quanyails',\n\t\t\t};\n\t\t\tbreak;\n\t\tcase 'waterfall':\n\t\t\tmenuColors = [\n\t\t\t\t\"119.31034482758622,37.66233766233767%\",\n\t\t\t\t\"184.36363636363635,23.012552301255226%\",\n\t\t\t\t\"108.92307692307692,37.14285714285714%\",\n\t\t\t\t\"70.34482758620689,20.567375886524818%\",\n\t\t\t\t\"98.39999999999998,36.76470588235296%\",\n\t\t\t\t\"140,38.18181818181818%\",\n\t\t\t];\n\t\t\tattrib = {\n\t\t\t\turl: 'https://yilx.deviantart.com/art/Irie-372292729',\n\t\t\t\ttitle: 'Irie',\n\t\t\t\tartist: 'Samuel Teo',\n\t\t\t};\n\t\t\tbreak;\n\t\tcase 'shaymin':\n\t\t\tmenuColors = [\n\t\t\t\t\"39.000000000000064,21.7391304347826%\",\n\t\t\t\t\"170.00000000000003,2.380952380952378%\",\n\t\t\t\t\"157.5,11.88118811881188%\",\n\t\t\t\t\"174.78260869565216,12.041884816753928%\",\n\t\t\t\t\"185.00000000000003,12.76595744680851%\",\n\t\t\t\t\"20,5.660377358490567%\",\n\t\t\t];\n\t\t\tattrib = {\n\t\t\t\turl: 'http://cargocollective.com/bluep',\n\t\t\t\ttitle: 'Shaymin',\n\t\t\t\tartist: 'Daniel Kong',\n\t\t\t};\n\t\t\tbreak;\n\t\tcase 'charizards':\n\t\t\tmenuColors = [\n\t\t\t\t\"37.159090909090914,74.57627118644066%\",\n\t\t\t\t\"10.874999999999998,70.79646017699115%\",\n\t\t\t\t\"179.51612903225808,52.10084033613446%\",\n\t\t\t\t\"20.833333333333336,36.73469387755102%\",\n\t\t\t\t\"192.3076923076923,80.41237113402063%\",\n\t\t\t\t\"210,29.629629629629633%\",\n\t\t\t];\n\t\t\tattrib = {\n\t\t\t\turl: 'https://seiryuuden.deviantart.com/art/The-Ultimate-Mega-Showdown-Charizards-414587079',\n\t\t\t\ttitle: 'Charizards',\n\t\t\t\tartist: 'Jessica Valencia',\n\t\t\t};\n\t\t\tbreak;\n\t\tcase 'digimon':\n\t\t\tmenuColors = [\n\t\t\t\t\"170.45454545454544,27.500000000000004%\",\n\t\t\t\t\"84.70588235294119,13.821138211382115%\",\n\t\t\t\t\"112.50000000000001,7.8431372549019605%\",\n\t\t\t\t\"217.82608695652175,54.761904761904766%\",\n\t\t\t\t\"0,1.6949152542372816%\",\n\t\t\t\t\"\",\n\t\t\t];\n\t\t}\n\t\tif (!menuColors && bgUrl.charAt(0) === '#') {\n\t\t\tconst r = parseInt(bgUrl.slice(1, 3), 16) / 255;\n\t\t\tconst g = parseInt(bgUrl.slice(3, 5), 16) / 255;\n\t\t\tconst b = parseInt(bgUrl.slice(5, 7), 16) / 255;\n\t\t\tconst hs = this.getHueSat(r, g, b);\n\t\t\tmenuColors = [hs, hs, hs, hs, hs, hs];\n\t\t}\n\t\tthis.attrib = attrib;\n\t\tthis.menuColors = menuColors;\n\t\tif (!menuColors) {\n\t\t\tthis.extractMenuColors(bgUrl);\n\t\t} else {\n\t\t\tthis.save(bgUrl);\n\t\t}\n\t}\n\textractMenuColors(bgUrl: string) {\n\t\tconst changeCount = this.changeCount;\n\t\t// We need the image object to load it on a canvas to detect the main color.\n\t\tconst img = new Image();\n\t\timg.onload = () => {\n\t\t\tif (changeCount === PSBackground.changeCount) return;\n\t\t\t// in case ColorThief throws from canvas,\n\t\t\t// or localStorage throws\n\t\t\ttry {\n\t\t\t\tconst colorThief = new ColorThief();\n\t\t\t\tconst colors = colorThief.getPalette(img, 5);\n\n\t\t\t\tlet menuColors = [];\n\t\t\t\tif (!colors) {\n\t\t\t\t\tmenuColors = ['0, 0%', '0, 0%', '0, 0%', '0, 0%', '0, 0%'];\n\t\t\t\t} else {\n\t\t\t\t\tfor (let i = 0; i < 5; i++) {\n\t\t\t\t\t\tconst color = colors[i];\n\t\t\t\t\t\tconst hs = PSBackground.getHueSat(color[0] / 255, color[1] / 255, color[2] / 255);\n\t\t\t\t\t\tmenuColors.unshift(hs);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.menuColors = menuColors;\n\t\t\t\tPSBackground.save(bgUrl);\n\t\t\t} catch {}\n\t\t};\n\t\timg.src = bgUrl;\n\t}\n\tgetHueSat(r: number, g: number, b: number) {\n\t\tconst max = Math.max(r, g, b);\n\t\tconst min = Math.min(r, g, b);\n\t\tif (max === min) {\n\t\t\treturn `0,0%`;\n\t\t}\n\t\tconst l = (max + min) / 2;\n\t\tconst d = max - min;\n\t\tconst s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n\t\tlet h = 0;\n\t\tswitch (max) {\n\t\tcase r: h = (g - b) / d + (g < b ? 6 : 0); break;\n\t\tcase g: h = (b - r) / d + 2; break;\n\t\tcase b: h = (r - g) / d + 4; break;\n\t\t}\n\t\th /= 6;\n\t\treturn `${h * 360},${s * 100}%`;\n\t}\n};\n\n/**********************************************************************\n * Core Views\n *********************************************************************/\n\nPSBackground.subscribe(bgUrl => {\n\tif (!PSBackground.curId) {\n\t\tdocument.body.style.background = '';\n\t\tdocument.body.style.backgroundSize = '';\n\t\tconst buttonStyleElem = document.getElementById('mainmenubuttoncolors');\n\t\tif (buttonStyleElem) buttonStyleElem.textContent = ``;\n\t\treturn;\n\t}\n\n\tif (bgUrl !== null) {\n\t\tlet background;\n\t\tif (bgUrl.charAt(0) === '#') {\n\t\t\tbackground = bgUrl;\n\t\t} else if (PSBackground.curId !== 'custom') {\n\t\t\tbackground = `#546bac url(${bgUrl}) no-repeat left center fixed`;\n\t\t} else {\n\t\t\tbackground = `#546bac url(${bgUrl}) no-repeat center center fixed`;\n\t\t}\n\t\tdocument.body.style.background = background;\n\t\tdocument.body.style.backgroundSize = 'cover';\n\t}\n\n\t// main menu button colors\n\tlet cssBuf = ``;\n\tlet n = 0;\n\tif (PSBackground.menuColors) {\n\t\tfor (const hs of PSBackground.menuColors) {\n\t\t\tn++;\n\t\t\tcssBuf += `body .button.mainmenu${n} { background: linear-gradient(to bottom,  hsl(${hs},72%),  hsl(${hs},52%)); border-color: hsl(${hs},40%); }\\n`;\n\t\t\tcssBuf += `body .button.mainmenu${n}:hover { background: linear-gradient(to bottom,  hsl(${hs},62%),  hsl(${hs},42%)); border-color: hsl(${hs},21%); }\\n`;\n\t\t\tcssBuf += `body .button.mainmenu${n}:active { background: linear-gradient(to bottom,  hsl(${hs},42%),  hsl(${hs},58%)); border-color: hsl(${hs},21%); }\\n`;\n\t\t}\n\t}\n\tlet buttonStyleElem = document.getElementById('mainmenubuttoncolors');\n\tif (!buttonStyleElem) {\n\t\tif (cssBuf) {\n\t\t\tbuttonStyleElem = new HTMLStyleElement();\n\t\t\tbuttonStyleElem.id = 'mainmenubuttoncolors';\n\t\t\tbuttonStyleElem.textContent = cssBuf;\n\t\t\tdocument.head!.appendChild(buttonStyleElem);\n\t\t}\n\t} else {\n\t\tbuttonStyleElem.textContent = cssBuf;\n\t}\n});\n// '<a href=\"https://vtas.deviantart.com/art/Pokemon-Horizon-312267168\" target=\"_blank\" class=\"subtle\">\"Horizon\" <small>background by Vivian Zou</small></a>';\n// if (attrib) attrib = '<small style=\"display:block;padding-bottom:4px\">' + attrib + '</small>';\n"],"mappings":"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"}